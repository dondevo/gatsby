const { process, maintainers } = require("../process")
const report = require("../pr-message")
const fs = require("fs")
const path = require("path")
const fixture = JSON.parse(
  fs.readFileSync(path.join(__dirname, "fixtures", "data.json"), `utf-8`)
)

test("Creates a correctly formatted Slack message", () => {
  const now = new Date(`2019-06-05T13:49:58Z`)
  const queues = process(fixture, now)
  const slackMessage = report(queues, maintainers, now)
  expect(slackMessage).toMatchSnapshot()

  // See https://api.slack.com/tools/block-kit-builder?blocks=%5B%7B%22type%22%3A%22section%22%2C%22text%22%3A%7B%22type%22%3A%22mrkdwn%22%2C%22text%22%3A%22Hi%2C%20this%20is%20your%20friendly%20PR%20BOT%20with%20the%20latest%20report%20on%20which%20PRs%20most%20need%20help%22%7D%7D%2C%7B%22type%22%3A%22divider%22%7D%2C%7B%22type%22%3A%22section%22%2C%22text%22%3A%7B%22type%22%3A%22mrkdwn%22%2C%22text%22%3A%22%5B9%5D%20*_PRs%20with%20no%20responses%20from%20maintainers_*%22%7D%7D%2C%7B%22type%22%3A%22section%22%2C%22text%22%3A%7B%22type%22%3A%22mrkdwn%22%2C%22text%22%3A%221.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F12761%7C%5BWIP%5D%3A%20chore(*)%3A%20publish%20es%20versions%20of%20browser%20packages%3E*%20%E2%80%94%20_created_%202%20months%20ago%20%E2%80%94%20_updated_%202%20months%20ago%5Cn2.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14216%7C%5BWIP%5D%20feat(schema)%3A%20Node%20interfaces%3E*%20%E2%80%94%20_created_%2015%20days%20ago%20%E2%80%94%20_updated_%2019%20days%20ago%5Cn3.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F13502%7Cfix(gatsby-plugin-offline)%3A%20Change%20navigation%20handler%20logic%3E*%20%E2%80%94%20_created_%202%20months%20ago%20%E2%80%94%20_updated_%209%20days%20ago%5Cn4.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14372%7Cremove%20slash%3E*%20%E2%80%94%20_created_%208%20days%20ago%20%E2%80%94%20_updated_%208%20days%20ago%5Cn5.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14443%7Cfix(gatsby)%3A%20Make%20requests%20not%20send%20credentials.%3E*%20%E2%80%94%20_created_%206%20days%20ago%20%E2%80%94%20_updated_%206%20days%20ago%5Cn6.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14483%7Cremove%20access%20control%20headers%3E*%20%E2%80%94%20_created_%204%20days%20ago%20%E2%80%94%20_updated_%204%20days%20ago%5Cn7.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14516%7Cchore(showcase)%3A%20add%20interplanetarygatsby.com%3E*%20%E2%80%94%20_created_%202%20days%20ago%20%E2%80%94%20_updated_%202%20days%20ago%5Cn8.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14527%7Cupdate%20testing-react-components.md%3E*%20%E2%80%94%20_created_%20a%20day%20ago%20%E2%80%94%20_updated_%20a%20day%20ago%5Cn9.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14532%7Cfeat(showcase)%3A%20add%20carine%20roitfeld%20site%3E*%20%E2%80%94%20_created_%20a%20day%20ago%20%E2%80%94%20_updated_%20a%20day%20ago%5Cn%22%7D%7D%2C%7B%22type%22%3A%22divider%22%7D%2C%7B%22type%22%3A%22section%22%2C%22text%22%3A%7B%22type%22%3A%22mrkdwn%22%2C%22text%22%3A%22%5B12%5D%20*_PRs%20with%20new%20commits%20awaiting%20review_*%22%7D%7D%2C%7B%22type%22%3A%22section%22%2C%22text%22%3A%7B%22type%22%3A%22mrkdwn%22%2C%22text%22%3A%221.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F11528%7Cfix(gatsby-remark-images)%3A%20remove%20clickable%20whitespace%20around%20image%20when%20linking%3E*%20%E2%80%94%20_created_%204%20months%20ago%20%E2%80%94%20_updated_%203%20months%20ago%E2%80%94%20commented%3A%20%3C%40dustin%3E%5Cn2.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F13985%7Cfeat(gatsby)%3A%20add%20prefetchPathname%20to%20programmatically%20prefetch%20(%238122)%3E*%20%E2%80%94%20_created_%2024%20days%20ago%20%E2%80%94%20_updated_%2022%20days%20ago%E2%80%94%20commented%3A%20%3C%40Ward%3E%20and%20%3C%40pieh%3E%5Cn3.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F12516%7Cfeat(publish)%3A%20clear%20built%20files%20before%20building%20package%20and%20packing%3E*%20%E2%80%94%20_created_%203%20months%20ago%20%E2%80%94%20_updated_%2016%20days%20ago%E2%80%94%20commented%3A%20%3C%40pieh%3E%20and%20%3C%40dustin%3E%5Cn4.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F14253%7CSupport%20%7B%23custom-id%7D%20header%20syntax%20in%20gatsby-remark-autolink-headers%3E*%20%E2%80%94%20_created_%2014%20days%20ago%20%E2%80%94%20_updated_%2013%20days%20ago%E2%80%94%20commented%3A%20%3C%40dustin%3E%5Cn5.%20*%3Chttps%3A%2F%2Fgithub.com%2Fgatsbyjs%2Fgatsby%2Fpull%2F13450%7Cfeat(gatsby-cli)%3A%20Add%20a%20plugin%2
  // console.log(JSON.stringify(slackMessage, null, 2))
})
